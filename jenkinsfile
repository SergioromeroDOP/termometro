pipeline {
    agent any

    stages {
        stage('Build') {
            steps {
                echo 'Building..'
                script {
                    if (
                        (env.BRANCH_NAME != "release-1.0" ) && 
                        (env.BRANCH_NAME != "master" ) && 
                        (env.BRANCH_NAME != "main" ) &&
                        (env.BRANCH_NAME != "cicd" )
                    ) {
                        echo "Llamando ci.checkAndMerge()"
                        // trustedci.checkAndMerge()
                    }
                    // ci.buildImages()
                    /*
                    deploy.Functions([
                        "project":  "sha-devops-dev-id",
                        "dir":      "mocks/functions/python/",
                    ])
                    */
                    /*
                    deploy.Worlflows([
                        "project":  "sha-devops-dev-id",
                        "dir":      "mocks/workflows/",
                        "location": "us-east1-b",
                    ])
                    */
                    
                    
                    // ptest.helloWorld()
                    // test.buildGo()
                }
            }
        }
        stage('Test') {
            steps {
                echo 'Testing..'
            }
        }

        stage("build & SonarQube analysis") {
            steps {
                withSonarQubeEnv("SonarQube") {
                    sh '${MAVEN} clean package sonar:sonar'
                }
            }
        }

        stage("Quality Gate") {
            steps {
                timeout(time: 1, unit: 'HOURS') {
                    withSonarQubeEnv("SonarQube") {
                        waitForQualityGate abortPipeline: true
                    }
                }
            }
        }

        stage('Deploy') {
            steps {
                echo 'Deploying....'
            }
        }

    }
}
